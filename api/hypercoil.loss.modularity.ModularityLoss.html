
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ModularityLoss &#8212; hypercoil prototype (unreleased) documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="secondmoment: Second moment-based losses" href="hypercoil.loss.secondmoment.html" />
    <link rel="prev" title="Equilibrium and SoftmaxEquilibrium" href="hypercoil.loss.equilibrium.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../modules.html">
  API reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     data
    </span>
   </code>
   : Data engineering
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.data.bids.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       bids
      </span>
     </code>
     : BIDS interfaces
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.bids.fmriprep_references.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         fmriprep_references
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.bids.fMRIPrepDataset.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         fMRIPrepDataset
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.bids.LightBIDSLayout.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         LightBIDSLayout
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.bids.BIDSObjectFactory.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         BIDSObjectFactory
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.bids.LightBIDSObject.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         LightBIDSObject
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.data.collate.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       collate
      </span>
     </code>
     : Batch collation functionality
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.data.dataref.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       dataref
      </span>
     </code>
     : Data references
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.dataref.DataReference.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DataReference
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.dataref.DataQuery.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DataQuery
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.dataref.data_references.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         data_references
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.data.dataset.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       dataset
      </span>
     </code>
     : Referenced datasets
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.dataset.ReferencedDataset.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         ReferencedDataset
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.dataset.ReferencedDataLoader.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         ReferencedDataLoader
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.data.functional.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       functional
      </span>
     </code>
     : Data transform functions
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.general.html">
       General use
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.filesystem.html">
       I/O and filesystem
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.tensor.html">
       Tensor casting and binding
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.dataframe.html">
       Data frames
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.neuroimage.html">
       Neuroimaging datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.metadata.html">
       Metadata
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.missing.html">
       Missing values
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.functional.timeseries.html">
       Time series
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.data.hcp.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       hcp
      </span>
     </code>
     : HCP interfaces
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.data.hcp.hcp_references.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         hcp_references
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../engine.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     engine
    </span>
   </code>
   : Differentiable engine
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.engine.accumulate.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       accumulate
      </span>
     </code>
     : Local gradient accumulation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.engine.accumulate.Accumulator.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         Accumulator
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../eval.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     eval
    </span>
   </code>
   : Benchmarks and evaluation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../functional.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     functional
    </span>
   </code>
   : Functions and functionals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../init.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     init
    </span>
   </code>
   : Initialisation schemes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="hypercoil.init.atlas.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       atlas
      </span>
     </code>
     : Atlas initialisation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.BaseAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         BaseAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.DirichletInitBaseAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DirichletInitBaseAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.DiscreteVolumetricAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DiscreteVolumetricAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.MultiVolumetricAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         MultiVolumetricAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.MultifileVolumetricAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         MultifileVolumetricAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.CortexSubcortexCIfTIAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         CortexSubcortexCIfTIAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.DirichletInitVolumetricAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DirichletInitVolumetricAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.DirichletInitSurfaceAtlas.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         DirichletInitSurfaceAtlas
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="hypercoil.init.atlas.AtlasInit.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         AtlasInit
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../loss.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     loss
    </span>
   </code>
   : Loss and regularisation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.cmass.Compactness.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       Compactness
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.cmass.HemisphericTether.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       HemisphericTether
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.determinant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       determinant
      </span>
     </code>
     : Log determinant-based losses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.dispersion.VectorDispersion.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       VectorDispersion
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.entropy.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       Entropy
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       SoftmaxEntropy
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.equilibrium.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       Equilibrium
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       SoftmaxEquilibrium
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     <code class="docutils literal notranslate">
      <span class="pre">
       ModularityLoss
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hypercoil.loss.secondmoment.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       secondmoment
      </span>
     </code>
     : Second moment-based losses
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../nn.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     nn
    </span>
   </code>
   : Neural network modules
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../viz.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     viz
    </span>
   </code>
   : Visualisation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="modularityloss">
<h1><code class="docutils literal notranslate"><span class="pre">ModularityLoss</span></code><a class="headerlink" href="#modularityloss" title="Permalink to this headline">#</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="hypercoil.loss.modularity.ModularityLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">hypercoil.loss.modularity.</span></span><span class="sig-name descname"><span class="pre">ModularityLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affiliation_xfm=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_diag=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null=&lt;function</span> <span class="pre">girvan_newman_null&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalise_modularity=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalise_coaffiliation=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directed=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sign='+'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hypercoil.loss.modularity.ModularityLoss" title="Permalink to this definition">#</a></dt>
<dd><p>Differentiable relaxation of the Girvan-Newman modularity.</p>
<p>This relaxation supports non-deterministic assignments of vertices to
communities and non-assortative linkages between communities. It reverts
to standard behaviour when the inputs it is provided are standard (i.e.,
deterministic and associative).</p>
<div class="admonition-girvan-newman-modularity-relaxation admonition">
<p class="admonition-title">Girvan-Newman Modularity Relaxation</p>
<p>The relaxed modularity loss is defined as the negative sum of all
entries in the Hadamard (elementwise) product between the modularity
matrix and the coaffiliation matrix.</p>
<p><span class="math notranslate nohighlight">\(\mathcal{L}_Q = -\nu_Q \mathbf{1}^\intercal \left( B \circ H \right) \mathbf{1}\)</span></p>
<a class="reference internal image-reference" href="../_images/modularityloss.svg"><img alt="../_images/modularityloss.svg" class="align-center" src="../_images/modularityloss.svg" width="500" /></a>
<ul class="simple">
<li><p>The modularity matrix <span class="math notranslate nohighlight">\(B\)</span> is the difference between the
observed connectivity matrix <span class="math notranslate nohighlight">\(A\)</span> and the expected connectivity
matrix under some null model that assumes no community structure,
<span class="math notranslate nohighlight">\(P\)</span>: <span class="math notranslate nohighlight">\(B = A - \gamma P\)</span>.</p>
<ul>
<li><p>The community resolution parameter <span class="math notranslate nohighlight">\(\gamma\)</span> essentially
determines the scale of the community structure that optimises the
relaxed modularity loss.</p></li>
<li><p>By default, we use the Girvan-Newman null model
<span class="math notranslate nohighlight">\(P_{GN} = \frac{A \mathbf{1} \mathbf{1}^\intercal A}{\mathbf{1}^\intercal A \mathbf{1}}\)</span>,
which can be interpreted as the expected weight of connections
between each pair of vertices if all existing edges are cut and
then randomly rewired.</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\(A \mathbf{1}\)</span> is the in-degree of the adjacency
matrix and <span class="math notranslate nohighlight">\(\mathbf{1}^\intercal A\)</span> is its out-degree, and
the two are transposes of one another for symmetric <span class="math notranslate nohighlight">\(A\)</span>.
Also note that the denominator
<span class="math notranslate nohighlight">\(\mathbf{1}^\intercal A \mathbf{1}\)</span> is twice the number of
edges for an undirected graph.)</p></li>
</ul>
</li>
<li><p>The coaffiliation matrix <span class="math notranslate nohighlight">\(H\)</span> is calculated as
<span class="math notranslate nohighlight">\(H = C_{in} L C_{out}^\intercal\)</span>, where
<span class="math notranslate nohighlight">\(C_{in} \in \mathbb{R}^{(v_{in} \times c)}\)</span> and
<span class="math notranslate nohighlight">\(C_{out} \in \mathbb{R}^{(v_{out} \times c)}\)</span> are proposed
assignment weights of in-vertices and out-vertices to communities.
<span class="math notranslate nohighlight">\(L \in \mathbb{R}^{c \times c)}\)</span> is the proposed coupling
matrix among each pair of communities and defaults to identity to
represent associative structure.</p>
<ul>
<li><p>Note that, when <span class="math notranslate nohighlight">\(C_{in} = C_{out}\)</span> is deterministically in
<span class="math notranslate nohighlight">\(\{0, 1\}\)</span> and <span class="math notranslate nohighlight">\(L = I\)</span>, this term reduces to the
familiar delta-function notation for the true Girvan-Newman
modularity.</p></li>
</ul>
</li>
</ul>
</div>
<p>Penalising this favours a weight that induces a modular community
structure on the input matrix – or, an input matrix whose structure
is reasonably accounted for by the proposed community affiliation
weights.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To conform with the network community interpretation of this loss
function, parameters representing the community affiliation <span class="math notranslate nohighlight">\(C\)</span>
and coupling <span class="math notranslate nohighlight">\(L\)</span> matrices can be pre-transformed. Mapping the
community affiliation matrix <span class="math notranslate nohighlight">\(C\)</span> through a
<span class="xref std std-doc">softmax</span>
function along the community axis lends the affiliation matrix the
intuitive interpretation of distributions over communities, or a
quantification of the uncertainty of each vertex’s community
assignment. Similarly, the coupling matrix can be pre-transformed
through a
<span class="xref std std-doc">sigmoid</span>
to constrain inter-community couplings to <span class="math notranslate nohighlight">\((0, 1)\)</span>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because the community affiliation matrices <span class="math notranslate nohighlight">\(C\)</span> induce
parcellations, we can regularise them using parcellation losses. For
instance, penalising the
<a class="reference internal" href="hypercoil.loss.entropy.html"><span class="doc">entropy</span></a>
will promote a solution wherein each node’s community assignment
probability distribution is concentrated in a single community.
Similarly, using parcel
<a class="reference internal" href="hypercoil.loss.equilibrium.html"><span class="doc">equilibrium</span></a> will favour a solution
wherein communities are of similar sizes.</p>
</div>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>nu</strong><span class="classifier">float (default 1)</span></dt><dd><p>Loss function weight multiplier.</p>
</dd>
<dt><strong>affiliation_xfm</strong><span class="classifier">callable or None (default None)</span></dt><dd><p>Transformation operating on the affiliation matrices (for instance, a
softmax). This transformation is precomposed with the relaxed
modularity.</p>
</dd>
<dt><strong>exclude_diag</strong><span class="classifier">bool (default True)</span></dt><dd><p>Exclude weights along the diagonal (i.e., self-loops) when computing
the modularity.</p>
</dd>
<dt><strong>gamma</strong><span class="classifier">nonnegative float (default 1)</span></dt><dd><p>Resolution parameter for the modularity matrix. A smaller value assigns
maximum modularity to partitions with large communities, while a larger
value assigns maximum modularity to partitions with many small
communities.</p>
</dd>
<dt><strong>null</strong><span class="classifier">callable (default <cite>girvan_newman_null</cite>)</span></dt><dd><p>Function of the input tensor block that returns, for each adjacency
matrix in the input tensor block, a suitable null model.</p>
</dd>
<dt><strong>normalise_modularity</strong><span class="classifier">bool (default True)</span></dt><dd><p>Indicates that the resulting matrix should be normalised by the total
matrix degree. This may not be necessary for many use cases – for
instance, where the arg max of a function of the modularity matrix is
desired.</p>
</dd>
<dt><strong>normalise_coaffiliation</strong><span class="classifier">bool (default True)</span></dt><dd><p>Indicates that all weights in the community assignment matrix block
should be renormalised to max out at 1. Note that this is unnecessary
if the affiliations have already been passed through a softmax.</p>
</dd>
<dt><strong>directed</strong><span class="classifier">bool (default False)</span></dt><dd><p>Indicates that the input adjacency matrices should be considered as a
directed graph.</p>
</dd>
<dt><strong>sign</strong><span class="classifier">‘+’, ‘-’, or None (default ‘+’)</span></dt><dd><p>Sign of connections to be considered in the modularity.</p>
</dd>
<dt><strong>name</strong><span class="classifier">str or None (default None)</span></dt><dd><p>Identifying string for the instantiation of the loss object.</p>
</dd>
<dt><strong>**params</strong></dt><dd><p>Any additional parameters are passed to the null model.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="autosummary longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#hypercoil.loss.modularity.ModularityLoss.forward" title="hypercoil.loss.modularity.ModularityLoss.forward"><code class="xref py py-obj docutils literal notranslate"><span class="pre">forward</span></code></a>(A, C[, C_o, L])</p></td>
<td><p>Compute a differentiable relaxation of the Girvan-Newman modularity.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Methods Documentation</p>
<dl class="py method">
<dt class="sig sig-object py" id="hypercoil.loss.modularity.ModularityLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C_o</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hypercoil.loss.modularity.ModularityLoss.forward" title="Permalink to this definition">#</a></dt>
<dd><p>Compute a differentiable relaxation of the Girvan-Newman modularity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>A</strong><span class="classifier">Tensor</span></dt><dd><p>Block of adjacency matrices for which the modularity is to be
computed.</p>
</dd>
<dt><strong>C</strong><span class="classifier">Tensor</span></dt><dd><p>Proposed community affiliation of vertices in the source set. Each
slice is a matrix <span class="math notranslate nohighlight">\(C^{(i)} \in \mathbb{R}^{I \ times C}\)</span>
that encodes the uncertainty in each vertex’s community
assignment. <span class="math notranslate nohighlight">\(C^{(i)}_{jk}\)</span> denotes the probability that
vertex j is assigned to community k. If this is binary-valued,
then it reflects a deterministic assignment and reduces to the
standard Girvan-Newman modularity.</p>
</dd>
<dt><strong>C_o</strong><span class="classifier">Tensor or None (default None)</span></dt><dd><p>Community affiliation of vertices in the sink set. If None, then
it is assumed that the source and sink sets are the same, and
<cite>C_o</cite> is set equal to <cite>C</cite>.</p>
</dd>
<dt><strong>L</strong><span class="classifier">Tensor or None (default None)</span></dt><dd><p>Probability of affiliation between communities. Each entry
<span class="math notranslate nohighlight">\(L_{ij}\)</span> encodes the probability of a vertex in community i
connecting with a vertex in community j. If None, then a strictly
assortative structure is assumed (equivalent to L equals
identity), under which nodes in the same community preferentially
coaffiliate while nodes in different communities remain
disaffiliated.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hypercoil.loss.modularity.ModularityLoss.register_sentry">
<span class="sig-name descname"><span class="pre">register_sentry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sentry</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hypercoil.loss.modularity.ModularityLoss.register_sentry" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="hypercoil.loss.modularity.ModularityLoss.register_action">
<span class="sig-name descname"><span class="pre">register_action</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#hypercoil.loss.modularity.ModularityLoss.register_action" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, the development team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>